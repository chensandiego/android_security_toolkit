<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Security Analysis</title>
    <style>
        body {
            font-family: sans-serif;
        }
        #results {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Upload APK for Analysis</h1>
    <form id="upload-form">
        <input type="file" name="file" id="file-input" accept=".apk">
        <button type="submit">Analyze</button>
    </form>

    <div id="results" style="display:none;">
        <h2>Analysis Results</h2>
        <p><strong>Filename:</strong> <span id="filename"></span></p>
        <p><strong>Classification:</strong> <span id="classification"></span></p>
        <h3>Features</h3>
        <pre id="features"></pre>

        <h3>Hardcoded Secrets</h3>
        <div id="hardcoded-secrets"></div>

        <h3>Identified Libraries</h3>
        <div id="identified-libraries"></div>

        <h3>Vulnerabilities:</h3>
            <ul id="vulnerabilitiesList"></ul>

            <h3>Insecure Communication Findings:</h3>
            <ul id="insecureCommunicationList"></ul>

            <h3>Insecure Data Storage Findings:</h3>
            <ul id="insecureDataStorageList"></ul>

            <h3>WebView Vulnerabilities:</h3>
            <ul id="webviewVulnerabilitiesList"></ul>
        </div>
    </div>

    <script>
        document.getElementById('apkUploadForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const response = await fetch('/analyze', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            document.getElementById('resultFilename').textContent = result.filename;
            document.getElementById('resultClassification').textContent = result.classification;
            document.getElementById('resultSimilarity').textContent = result.similarity;

            const features = result.features;

            // Clear previous results
            document.getElementById('permissionsList').innerHTML = '';
            document.getElementById('activitiesList').innerHTML = '';
            document.getElementById('servicesList').innerHTML = '';
            document.getElementById('receiversList').innerHTML = '';
            document.getElementById('hardcodedSecretsList').innerHTML = '';
            document.getElementById('identifiedLibrariesList').innerHTML = '';
            document.getElementById('vulnerabilitiesList').innerHTML = '';
            document.getElementById('insecureCommunicationList').innerHTML = '';
            document.getElementById('insecureDataStorageList').innerHTML = '';
            document.getElementById('webviewVulnerabilitiesList').innerHTML = '';

            // Populate permissions
            features.permissions.forEach(p => {
                const li = document.createElement('li');
                li.textContent = p;
                document.getElementById('permissionsList').appendChild(li);
            });

            // Populate activities
            features.activities.forEach(a => {
                const li = document.createElement('li');
                li.textContent = a;
                document.getElementById('activitiesList').appendChild(li);
            });

            // Populate services
            features.services.forEach(s => {
                const li = document.createElement('li');
                li.textContent = s;
                document.getElementById('servicesList').appendChild(li);
            });

            // Populate receivers
            features.receivers.forEach(r => {
                const li = document.createElement('li');
                li.textContent = r;
                document.getElementById('receiversList').appendChild(li);
            });

            // Populate hardcoded secrets
            for (const file in features.hardcoded_secrets) {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${file}:</strong>`;
                const ul = document.createElement('ul');
                for (const secret_type in features.hardcoded_secrets[file]) {
                    const secret_li = document.createElement('li');
                    secret_li.textContent = `${secret_type}: ${features.hardcoded_secrets[file][secret_type].join(', ')}`;
                    ul.appendChild(secret_li);
                }
                li.appendChild(ul);
                document.getElementById('hardcodedSecretsList').appendChild(li);
            }

            // Populate identified libraries
            features.identified_libraries.forEach(lib => {
                const li = document.createElement('li');
                li.textContent = lib;
                document.getElementById('identifiedLibrariesList').appendChild(li);
            });

            // Populate vulnerabilities
            features.vulnerabilities.forEach(vuln => {
                const li = document.createElement('li');
                li.textContent = `${vuln.cve} - ${vuln.description} (Severity: ${vuln.severity})`;
                document.getElementById('vulnerabilitiesList').appendChild(li);
            });

            // Populate insecure communication findings
            features.insecure_communication.forEach(finding => {
                const li = document.createElement('li');
                li.textContent = finding;
                document.getElementById('insecureCommunicationList').appendChild(li);
            });

            // Populate insecure data storage findings
            features.insecure_data_storage.forEach(finding => {
                const li = document.createElement('li');
                li.textContent = finding;
                document.getElementById('insecureDataStorageList').appendChild(li);
            });

            // Populate webview vulnerabilities
            features.webview_vulnerabilities.forEach(finding => {
                const li = document.createElement('li');
                li.textContent = finding;
                document.getElementById('webviewVulnerabilitiesList').appendChild(li);
            });

            document.getElementById('results').style.display = 'block';
        });
    </script>
</body>
</html>